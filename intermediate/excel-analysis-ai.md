# Excelデータ分析 + AI活用

**所要時間**: 45分  
**レベル**: 中級  
**前提知識**: [Excel VBA + AI](excel-vba-ai.md)完了

## 学習目標

この講座を修了すると、以下ができるようになります：
- AIを使ってExcelでデータ分析を効率化できる
- 基本的な統計分析を自動化できる
- ビジネス向けのグラフ・ダッシュボードを作成できる
- データから意味のある洞察を抽出できる

---

## データ分析の基本アプローチ

### AI活用分析の基本プロンプト

```
以下のデータを分析してください。

【データ内容】
[データの構造と内容を説明]

【分析目的】
[何を知りたいか、どんな課題を解決したいか]

【分析方法】
[使いたい分析手法があれば指定]

【出力希望】
- 分析結果の要約
- Excelで実行する具体的な手順
- 使用する関数・機能

実際にExcelで実行可能な形で教えてください。
```

---

## 基本統計分析の自動化

### 記述統計の生成

#### 売上データの基本分析

**プロンプト**:
```
月次売上データの基本統計を分析したいです。

【データ】
- A列: 月（2023-01～2024-12）
- B列: 売上金額

【知りたいこと】
- 平均、中央値、最大・最小値
- 標準偏差と変動係数
- 季節性の傾向
- 成長率の分析

Excelの関数で実現する方法を教えてください。
```

**AI回答例**:
```excel
# 基本統計量
平均値: =AVERAGE(B:B)
中央値: =MEDIAN(B:B)
最大値: =MAX(B:B)
最小値: =MIN(B:B)
標準偏差: =STDEV.P(B:B)
変動係数: =STDEV.P(B:B)/AVERAGE(B:B)

# 前年同月比（例：C列に配置）
=IF(ROW()<=12,"",B2/OFFSET(B2,-12,0)-1)

# 移動平均（3ヶ月、D列に配置）
=IF(ROW()<4,"",AVERAGE(OFFSET(B2,-2,0,3,1)))
```

### 相関分析

#### 要因分析

**プロンプト**:
```
店舗売上に影響する要因を分析したいです。

【データ】
- A列: 店舗名
- B列: 月間売上
- C列: 広告費
- D列: スタッフ数
- E列: 客単価

【分析したいこと】
1. 各要因と売上の相関係数
2. 散布図でのトレンド確認
3. 重要度ランキング

Excelでできる範囲で教えてください。
```

**AI回答例**:
```excel
# 相関係数の計算
売上×広告費: =CORREL(B:B,C:C)
売上×スタッフ数: =CORREL(B:B,D:D)
売上×客単価: =CORREL(B:B,E:E)

# 相関分析表の作成手順
1. データ→データ分析→相関を選択
2. 入力範囲: B1:E100（データ範囲）
3. 先頭行をラベルとして使用: チェック
4. 出力先を指定して実行

# 散布図作成手順
1. 2つの列を選択（例：B列とC列）
2. 挿入→グラフ→散布図
3. トレンドライン追加→線形近似
4. R²値を表示して相関の強さを確認
```

---

## 売上分析の実践例

### 月次売上トレンド分析

**プロンプト**:
```
2年間の月次売上データから以下を分析したいです：

【データ】24ヶ月分の月次売上

【分析項目】
1. 月別の平均売上と成長率
2. 季節性パターンの発見
3. 売上予測（3ヶ月先まで）
4. 目標達成度の評価

実用的な分析手順を教えてください。
```

**AI分析手順**:

#### Step 1: 基本指標の計算
```excel
# C列: 前年同月比
=IF(ROW()<=13, "", (B2/INDEX(B:B,ROW()-12))-1)

# D列: 前月比
=IF(ROW()<=2, "", (B2/B1)-1)

# E列: 移動平均（3ヶ月）
=IF(ROW()<=3, "", AVERAGE(OFFSET(B2,-2,0,3,1)))
```

#### Step 2: 季節性分析
```excel
# F列: 月を抽出
=MONTH(A2)

# 月別平均売上（別表）
1月平均: =AVERAGEIF(F:F,1,B:B)
2月平均: =AVERAGEIF(F:F,2,B:B)
（以下12月まで）

# 季節指数
1月季節指数: =AVERAGEIF(F:F,1,B:B)/AVERAGE(B:B)
```

#### Step 3: 簡易予測
```excel
# トレンド係数を計算
=SLOPE(B2:B25,ROW(B2:B25))

# 予測値（線形トレンド）
来月予測: =INTERCEPT(B2:B25,ROW(B2:B25))+SLOPE(B2:B25,ROW(B2:B25))*26
```

### 商品別売上分析

**プロンプト**:
```
商品別売上データからABC分析を行いたいです。

【データ】
- A列: 商品名
- B列: 売上金額

【分析内容】
1. 売上金額順の並び替え
2. 累積売上率の計算
3. ABCランク分類（A:80%、B:15%、C:5%）
4. 結果の可視化

手順を教えてください。
```

**AI分析手順**:

#### Step 1: データの準備と並び替え
```
1. データ全体を選択
2. データ→並び替え
3. 売上金額で降順に並び替え
```

#### Step 2: ABC分析の計算
```excel
# C列: 累積売上金額
C2: =B2
C3: =C2+B3
（以下、最後の行まで）

# D列: 累積売上率
=C2/SUM($B:$B)

# E列: ABCランク判定
=IF(D2<=0.8,"A",IF(D2<=0.95,"B","C"))
```

#### Step 3: 可視化
```
1. 商品名（A列）と累積売上率（D列）を選択
2. 挿入→グラフ→折れ線グラフ
3. パレート図風のグラフが完成
```

---

## グラフとダッシュボード作成

### 動的ダッシュボードの作成

**プロンプト**:
```
売上ダッシュボードを作成したいです。

【要件】
1. 期間選択機能（ドロップダウン）
2. 選択期間に応じたKPI表示
3. グラフの自動更新
4. 商品別売上TOP5

実装方法を教えてください。
```

**AI実装手順**:

#### Step 1: 基本構造の作成
```
# レイアウト設計
A1:C1: タイトル「売上ダッシュボード」
A3: 期間選択
B3: ドロップダウン（データ→入力規則→リスト）
A5:C8: KPI表示エリア
A10:G20: グラフエリア
I3:K15: TOP5表
```

#### Step 2: 動的参照の設定
```excel
# B3セル: 期間選択用ドロップダウン
入力規則→リスト→元の値: 2024年1月,2024年2月,2024年3月

# KPI計算（選択された月のデータ）
売上合計: =SUMIF(月列,B3,売上列)
前月比: =売上合計/SUMIF(月列,前月,売上列)-1
目標達成率: =売上合計/目標値

# TOP5計算
=LARGE(商品別売上範囲,ROW(A1:A5))
```

#### Step 3: グラフの動的更新
```
1. グラフのデータ範囲をINDIRECT関数で動的に設定
2. グラフタイトルに選択期間を表示
3. 条件付き書式で視覚的な強調
```

### 業務レポートの自動化

**プロンプト**:
```
週次業績レポートを自動生成したいです。

【データソース】
日次売上データ（日付、店舗、売上）

【レポート内容】
1. 週間売上サマリー
2. 店舗別実績と目標比較
3. 前週比較
4. アラート（目標未達店舗）

VBAとグラフを組み合わせた方法を教えてください。
```

**AI実装例**:

#### VBAでの自動集計
```vb
Sub CreateWeeklyReport()
    Dim wsData As Worksheet
    Dim wsReport As Worksheet
    Dim weekStart As Date
    Dim weekEnd As Date
    
    ' 対象週を設定（先週）
    weekEnd = Date - Weekday(Date) + 1
    weekStart = weekEnd - 6
    
    ' レポートシート作成
    Set wsReport = CreateReportSheet("週次レポート")
    
    ' サマリー作成
    CreateWeeklySummary wsData, wsReport, weekStart, weekEnd
    
    ' 店舗別分析
    CreateStoreAnalysis wsData, wsReport, weekStart, weekEnd
    
    MsgBox "週次レポートが完成しました。"
End Sub

Sub CreateWeeklySummary(wsData As Worksheet, wsReport As Worksheet, startDate As Date, endDate As Date)
    Dim totalSales As Double
    
    ' SUMIFS関数で期間内売上を集計
    totalSales = Application.SumIfs(wsData.Range("C:C"), _
                                   wsData.Range("A:A"), ">=" & startDate, _
                                   wsData.Range("A:A"), "<=" & endDate)
    
    ' レポートに結果出力
    wsReport.Range("B2").Value = "週間売上合計"
    wsReport.Range("C2").Value = totalSales
    wsReport.Range("C2").NumberFormat = "#,##0"
End Sub
```

---

## 実践的な分析事例

### 顧客分析ダッシュボード

**プロンプト**:
```
顧客データから以下を分析するダッシュボードを作成したいです：

【データ】
- 顧客ID、購入日、購入金額、商品カテゴリ

【分析項目】
1. 新規・既存顧客の売上割合
2. 顧客あたりの平均購入額
3. リピート率の計算
4. 商品カテゴリ別の顧客分布

Excelで実現可能な方法を教えてください。
```

**AI分析手順**:

#### 顧客セグメンテーション
```excel
# 初回購入日を特定
=MIN(IF(顧客ID列=A2,購入日列))

# 新規・既存判定
=IF(購入日-初回購入日<=30,"新規","既存")

# 購入回数
=COUNTIF(顧客ID列,A2)

# リピート率
=COUNTIFS(顧客ID列,顧客ID列,購入回数列,">1")/COUNT(UNIQUE(顧客ID列))
```

### 在庫分析システム

**プロンプト**:
```
在庫データの分析システムを作りたいです。

【機能】
1. 回転率の計算
2. 死に筋商品の特定
3. 発注推奨アラート
4. ABC分析による重要度分類

実用的な分析方法を教えてください。
```

**AI分析例**:

#### 在庫回転率分析
```excel
# 月間売上数量（過去3ヶ月平均）
=AVERAGE(過去3ヶ月売上数量)

# 在庫回転率
=月間平均売上数量/現在庫数

# 在庫日数
=現在庫数/月間平均売上数量*30

# 発注推奨判定
=IF(在庫日数<安全在庫日数,"発注推奨","在庫充分")
```

---

## 実践演習

### 演習1: 売上トレンド分析

以下のデータで分析を実施してください：

```
【データ】
12ヶ月の月次売上データ

【課題】
1. 成長率の計算と評価
2. 季節性パターンの発見
3. 来月の売上予測
4. 目標との乖離分析

【作成する分析】:
使用する関数:
分析結果:
改善提案:
```

### 演習2: 商品分析ダッシュボード

商品別売上データからダッシュボードを作成してください：

```
【要件】
- 商品選択機能
- 選択商品の月次トレンド
- 売上構成比の表示
- 競合商品との比較

【設計内容】:
レイアウト:
使用する関数・機能:
グラフの種類:
```

---

## よくある分析の落とし穴

### データの品質確認

**重要なチェックポイント**:
```
1. 欠損値の確認
   =COUNTA(データ範囲)/ROWS(データ範囲)

2. 重複データの検出
   =SUMPRODUCT(--(COUNTIFS(列1,列1,列2,列2)>1))

3. 異常値の確認
   =COUNTIFS(データ列,">"&平均値+標準偏差*3)

4. データ型の統一確認
   =SUMPRODUCT(--(ISNUMBER(数値列)))
```

### 分析結果の解釈

**注意すべき点**:
- 相関関係と因果関係の混同を避ける
- サンプルサイズが十分かを確認
- 季節性やトレンドの影響を考慮
- 業界・市場環境の変化を加味

---

## まとめ

Excelを使ったAI活用データ分析では、以下のポイントが重要です：

- **目的を明確にしてから分析手法を選択**
- **データの品質を最初に確認**
- **視覚化で結果を分かりやすく表現**
- **分析結果を具体的なアクションにつなげる**

これでExcel + AI活用の3部作は完了です。実際の業務でぜひ活用してください！