# 🤖 Excel VBA × AI活用 〜完全初心者でもマクロが作れる！〜

**所要時間**: 60分  
**レベル**: 完全初心者（VBA知識不要）  
**前提知識**: Excelの基本操作（セルの入力、コピー&ペースト程度）

## 🎯 この講座のゴール

- VBAって何？を身近な例で理解する
- AIにお願いしてマクロを作ってもらう方法を覚える
- 実際に業務で使えるマクロを3つ作成する
- エラーが出ても慌てず対処できるようになる

---

## 🤔 VBAって何？なぜAIと組み合わせると効果的なの？

### 身近な例で理解しよう

#### あなたの毎日の繰り返し作業
- **朝の業務**: ①PC起動 → ②メールチェック → ③売上データを開く → ④昨日の集計
- **データ整理**: ①CSVをダウンロード → ②不要な列を削除 → ③書式を整える → ④グラフ作成
- **報告書作成**: ①各支店のデータ収集 → ②まとめて集計 → ③レポート作成 → ④上司にメール

これら全て「**毎回同じ手順の繰り返し**」ですよね？

### VBA = Excelに「お疲れ様、後は任せて！」と言ってもらう仕組み

#### 人間がやること vs VBAがやること

**人間がやること（大変...）**:
- 毎日同じ作業を手作業で繰り返し
- ミスがないかドキドキしながらチェック
- 「また今日もこの作業か...」とため息

**VBAがやること（楽々！）**:
- ボタン1つで全自動実行
- ミスなく正確に毎回同じ処理
- あなたは他の重要な仕事に集中可能

### 簡単に言うと...
**VBA = Excelを自動操縦するロボット。AIがそのロボットの設計図を作ってくれる！**

### 🛠️ 準備：VBAを使えるようにしよう（3分でできる！）

#### Step1: 開発タブを表示させる

**開発タブが見えない場合（ほとんどの人がこの状態）**:
1. Excelの上部メニューで `ファイル` をクリック
2. 一番下の `オプション` をクリック
3. 左メニューの `リボンのユーザー設定` をクリック
4. 右側の一覧で `開発` にチェック ✅
5. `OK` をクリック

**できました！** これでExcel上部に「開発」タブが表示されます。

#### Step2: VBAエディタを開いてみる（ドキドキの瞬間）
- 「開発」タブ → 「Visual Basic」をクリック
- または便利なショートカット：`Alt + F11`

**新しい画面が開きましたね！** これがVBAエディタです。プログラムを作る専用の画面です。

#### Step3: 新しいモジュールを作成する（重要な手順！）

**VBAエディタが開いたら、まずモジュールを作成します**：
1. VBAエディタの上部メニューで「**挿入**」をクリック
2. 「**標準モジュール**」をクリック
3. 「Module1」という新しい項目が左側に表示される
4. 右側に白い画面（コードウィンドウ）が表示される

**これで準備完了！** この白い画面にVBAコードを書いていきます。

### 👀 VBAエディタの画面説明（全然怖くない！）

#### 画面の左側「プロジェクトエクスプローラー」
- **何これ？**: あなたのExcelファイルの「中身の一覧表」
- **見えるもの**: Sheet1、Sheet2、ThisWorkbook など
- **例えると**: スマホのアプリ一覧みたいなもの

#### 画面の真ん中「コードウィンドウ」
- **何これ？**: VBAコード（指示書）を書く場所
- **見た目**: メモ帳みたいな白い画面
- **例えると**: レシピを書くノート

#### 画面下の「イミディエイトウィンドウ」
- **何これ？**: 簡単なテストができる場所
- **使い道**: 「ちゃんと動くか確認」用
- **例えると**: 料理の味見をするスプーン

**安心してください**: 最初は真ん中の「コードウィンドウ」だけ使えれば十分です！

### 🎉 はじめてのマクロを作ってみよう！（成功体験が大事）

#### 超簡単な「挨拶マクロ」を作成

**Step1**: 上記の手順でモジュールを作成後、右側のコードウィンドウに以下をコピペ
```vb
Sub はじめての挨拶()
    MsgBox "こんにちは！マクロデビューおめでとうございます！"
End Sub
```

**Step2**: 実行してみよう（ドキドキ）
- `F5`キーを押す（一番簡単！）
- または上部の「▶️実行」ボタンをクリック

**ポップアップが出ましたか？** 🎊 成功です！あなたは今VBAマクロを実行しました！

#### マクロの保存（重要！）
**普通の保存だとマクロが消えちゃいます！**
1. `Ctrl + S` で保存
2. 「ファイル形式」で「Excel マクロ有効ブック（.xlsm）」を選択
3. 「保存」をクリック

**これでマクロが保存されました！** 次回開いても使えます。

### 📚 VBAの基本ルール（むずかしそうだけど実は簡単）

#### 変数って何？「ラベル付きの箱」のこと

**身近な例で理解**:
```vb
' お客さんの情報を箱に入れる
Dim 顧客名 As String      ' 文字を入れる箱
Dim 年齢 As Integer       ' 数字を入れる箱  
Dim 購入金額 As Double     ' 小数点ありの数字を入れる箱

' 箱に値を入れる
顧客名 = "田中太郎"
年齢 = 35
購入金額 = 15800.50
```

#### よく使うデータ型（覚えるのは4つだけ！）
- **String**: 文字（名前、住所など）
- **Integer**: 整数（年齢、個数など）
- **Double**: 小数点数（金額、重さなど）
- **Boolean**: はい/いいえ（True/False）

**最初はこの4つだけ覚えれば十分！** 他は必要になったら調べましょう。

#### セルを操作する（これができれば何でもできる！）

**セルに値を入れる（手作業の代わり）**:
```vb
' A1セルに「売上データ」と入力
Range("A1").Value = "売上データ"

' 別の書き方（行番号、列番号で指定）
Cells(1, 1).Value = "売上データ"  ' 行1、列1 = A1セル
Cells(2, 3).Value = 15000        ' 行2、列3 = C2セルに数字
```

**セルの値を取得する（確認作業の代わり）**:
```vb
' A1セルの内容を確認
Dim セルの中身 As String
セルの中身 = Range("A1").Value
MsgBox セルの中身  ' 確認のためにポップアップ表示
```

**つまり**: `Range("A1")` = 「A1セル」、`.Value` = 「の中身」という意味です。

#### 条件分岐（「もし〜なら」の判断をVBAにさせる）

**日常会話で理解**:
```vb
' 売上が目標を達成しているかチェック
Dim 今月の売上 As Double
今月の売上 = Range("B1").Value

If 今月の売上 >= 1000000 Then
    MsgBox "目標達成！おめでとうございます！"
ElseIf 今月の売上 >= 800000 Then
    MsgBox "もう少しで目標達成です！"
Else
    MsgBox "来月がんばりましょう！"
End If
```

**つまり**:
- `If` = 「もし」
- `Then` = 「なら」  
- `ElseIf` = 「そうでなくてもし」
- `Else` = 「それ以外なら」
- `End If` = 「判断終了」

**人間の思考をそのままVBAで表現** できるんです！

#### 繰り返し処理（同じ作業を何回もVBAにやらせる）

**例1: 1から10まで数字を入力**
```vb
' A1からA10まで、順番に数字を入力
For i = 1 To 10
    Cells(i, 1).Value = i  ' 1行目のA列に1、2行目のA列に2...
Next i
```

**例2: 売上データを全部2倍にする**
```vb
' A1からA10の全部の数字を2倍にする
For Each セル In Range("A1:A10")
    セル.Value = セル.Value * 2
Next セル
```

**例3: 実際の業務っぽく**
```vb
' 商品名を100個の行に入力
For i = 1 To 100
    Cells(i, 1).Value = "商品" & i  ' 商品1、商品2、商品3...
Next i
```

**つまり**: 「100回同じ作業」も一瞬で完了！これがVBAの醍醐味です。

---

## 🤖 AIにVBAを作ってもらう方法（ここが一番重要！）

### 🎯 AIへの上手なお願いの仕方（テンプレート）

**このテンプレートをコピペして使ってください！**

```
ExcelのVBAマクロを作成してください。完全初心者なので、コメント多めでお願いします。

【やりたいこと】
普段手作業でやっている○○を自動化したい

【現在の手作業】
1. [具体的な手順1]
2. [具体的な手順2] 
3. [具体的な手順3]

【Excelの状況】
- シート名: [例: Sheet1]
- データがある場所: [例: A1からC100まで]
- データの内容: [例: 顧客名、購入日、金額]

【作ってほしいマクロ】
[ボタンを押したら○○が自動で完了するようにしたい]

【心配なこと】
- エラーが出たときの対処法も教えてください
- 初心者でも理解できるコメントをつけてください
```

**ポイント**: 「完全初心者」「コメント多めで」と最初に書くのがコツ！

### 🌟 実際にAIに作ってもらおう！（3つの実用例）

#### 例1: 「毎日やってるデータコピーを自動化したい」

**プロンプト**:
```
アクティブシートのA1:C10の範囲を、新しいワークシートにコピーするVBAマクロを作成してください。

【要件】
- 新しいシートの名前は「コピーデータ」
- 既に同名シートがある場合は削除してから作成
- 元データの書式も一緒にコピー
```

**AIが作ってくれるマクロ（例）**:
```vb
Sub CopyDataToNewSheet()
    Dim ws As Worksheet
    Dim newWs As Worksheet
    
    ' 既存の「コピーデータ」シートを削除
    On Error Resume Next
    Application.DisplayAlerts = False
    Worksheets("コピーデータ").Delete
    Application.DisplayAlerts = True
    On Error GoTo 0
    
    ' 新しいシートを作成
    Set newWs = Worksheets.Add
    newWs.Name = "コピーデータ"
    
    ' データをコピー
    ActiveSheet.Range("A1:C10").Copy
    newWs.Range("A1").PasteSpecial xlPasteAll
    
    ' コピーモードを解除
    Application.CutCopyMode = False
    
    MsgBox "データのコピーが完了しました。"
End Sub
```

#### 例2: 条件に基づく書式設定

**プロンプト**:
```
売上データの書式を自動設定するVBAマクロを作成してください。

【データ】
- B列: 売上金額（数値）
- 対象範囲: B2:B100

【書式設定】
- 100万円以上: 背景色を緑、文字を太字
- 50万円以上: 背景色を黄色
- 30万円未満: 背景色を薄い赤
```

**AIが作ってくれるマクロ（例）**:
```vb
Sub FormatSalesData()
    Dim rng As Range
    Dim cell As Range
    
    ' 対象範囲を設定
    Set rng = Range("B2:B100")
    
    ' 各セルをチェックして書式設定
    For Each cell In rng
        If IsNumeric(cell.Value) And cell.Value <> "" Then
            Select Case cell.Value
                Case Is >= 1000000
                    ' 100万円以上: 緑背景、太字
                    cell.Interior.Color = RGB(144, 238, 144)
                    cell.Font.Bold = True
                    
                Case Is >= 500000
                    ' 50万円以上: 黄色背景
                    cell.Interior.Color = RGB(255, 255, 0)
                    cell.Font.Bold = False
                    
                Case Is < 300000
                    ' 30万円未満: 薄い赤背景
                    cell.Interior.Color = RGB(255, 182, 193)
                    cell.Font.Bold = False
                    
                Case Else
                    ' その他: 書式クリア
                    cell.Interior.ColorIndex = xlNone
                    cell.Font.Bold = False
            End Select
        End If
    Next cell
    
    MsgBox "書式設定が完了しました。"
End Sub
```

---

## 💼 実際の業務で使える！便利マクロ集

### 📁 ファイル整理系（事務作業が大幅に効率化される）

#### CSVファイルの一括読み込み

**プロンプト**:
```
指定フォルダ内のすべてのCSVファイルを読み込んで、1つのシートにまとめるVBAマクロを作成してください。

【要件】
- フォルダはユーザーが指定
- 各ファイルのデータを縦に連結
- ファイル名を最初の列に追加
- ヘッダー行は最初のファイルのみ残す
```

**AIが作ってくれるマクロ（例）**:
```vb
Sub ImportMultipleCSV()
    ' フォルダ選択とCSVファイル統合の処理
    ' （実際のコードは100行程度になりますが、ここでは概要のみ）
    
    ' 1. フォルダ選択ダイアログを表示
    ' 2. フォルダ内の全CSVファイルを検索
    ' 3. 各ファイルを順番に開いて内容を読み込み
    ' 4. ファイル名を第1列に追加
    ' 5. ヘッダー行の重複を回避
    ' 6. 統合結果を現在のシートに出力
    
    MsgBox "CSVファイルの統合が完了しました！"
End Sub
```

**💡 ポイント**:
- **長いコードでも怖がらない**：AIが詳細なコメントをつけてくれるので、何をしているか理解できます
- **フォルダ選択**：ダイアログが出るので、マウスでフォルダを選ぶだけ
- **エラー処理**：ファイルが開けない場合もちゃんと対応してくれます

### 📊 データ整理系（データがきれいになる）

#### 重複データの削除と整理

**プロンプト**:
```
顧客データの重複を削除して整理するVBAマクロを作成してください。

【データ構造】
- A列: 顧客ID
- B列: 顧客名
- C列: 電話番号
- D列: メールアドレス

【処理内容】
1. 顧客IDが重複している行を削除（新しいデータを残す）
2. 空白行を削除
3. 電話番号の形式を統一（ハイフンを削除）
4. 結果を別シートに出力
```

**AIが作ってくれるマクロ（例）**:
```vb
Sub CleanCustomerData()
    ' 顧客データ整理の処理
    
    ' 1. 新しいシート「整理済み顧客データ」を作成
    ' 2. 元データから1行ずつチェック
    '    - 空白行は飛ばす  
    '    - 既に処理済みの顧客IDは飛ばす（重複排除）
    '    - 電話番号のハイフンを削除して統一
    ' 3. きれいになったデータを新シートに出力
    
    MsgBox "顧客データの整理が完了しました！"
End Sub
```

**🎯 実際の効果**:
- **手作業3時間** → **ボタン1つで30秒**
- **ヒューマンエラーゼロ**：見落としや入力ミスなし
- **品質向上**：電話番号の形式も自動で統一

---

## 🚨 エラーが出ても大丈夫！対処法

### 😱 「オブジェクトが設定されていません」エラーの直し方

#### 初心者が一番最初に遭遇するエラー

**プロンプト**:
```
以下のVBAコードで「オブジェクトが設定されていません」エラーが発生します。修正してください。

【エラーコード】
Sub TestMacro()
    Dim ws As Worksheet
    ws.Range("A1").Value = "テスト"
End Sub

【修正要件】
- エラーが発生しても処理を継続
- エラー内容をユーザーに分かりやすく表示
```

**AIが修正してくれるコード**:
```vb
Sub TestMacro()
    Dim ws As Worksheet
    
    On Error GoTo ErrorHandler  ' エラーが出たらErrorHandlerに飛ぶ
    
    ' 【修正ポイント】ワークシートオブジェクトを正しく設定
    Set ws = ActiveSheet  ' ← この行が抜けていた！
    
    ' セルに値を設定
    ws.Range("A1").Value = "テスト"
    
    MsgBox "処理が完了しました。"
    Exit Sub  ' 正常終了の場合はここで終わり
    
ErrorHandler:  ' エラーが発生した時の処理
    MsgBox "エラーが発生しました: " & Err.Description & vbCrLf & _
           "処理を中断します。", vbCritical
End Sub
```

**😊 安心ポイント**:
- **AIが原因を説明**：「`Set ws = ActiveSheet` が抜けていた」と教えてくれる
- **エラー対策も追加**：プログラムがフリーズしないように保護
- **初心者向けコメント**：何をしているか分かりやすく説明

### 🔄 長時間の処理中に「今何％完了？」を表示する方法

#### 大量データ処理でフリーズしたかと思っちゃう問題を解決

**プロンプト**:
```
大量データを処理するVBAマクロに進捗表示機能を追加してください。

【現在のコード概要】
1000行のデータを1行ずつ処理するループ

【追加したい機能】
- 処理状況をステータスバーに表示
- 10%ごとに進捗をメッセージ表示
- 処理のキャンセル機能
```

**AIが作ってくれる進捗表示付きマクロ（例）**:
```vb
Sub ProcessDataWithProgress()
    Dim totalRows As Long
    Dim currentRow As Long
    
    totalRows = 1000 ' 処理する行数
    
    For currentRow = 1 To totalRows
        ' 実際の処理（例：データ変更）
        Cells(currentRow, 1).Value = "処理済み" & currentRow
        
        ' 画面下部に進捗表示「処理中...45% (450/1000)」
        Application.StatusBar = "処理中... " & Int((currentRow / totalRows) * 100) & "% (" & currentRow & "/" & totalRows & ")"
        
        ' 100行ごとに「続行しますか？」の確認
        If currentRow Mod 100 = 0 Then
            If MsgBox(Int((currentRow / totalRows) * 100) & "% 完了。続行しますか？", vbYesNo) = vbNo Then
                Exit For  ' キャンセルで処理中断
            End If
        End If
    Next currentRow
    
    Application.StatusBar = False  ' ステータス表示をクリア
    MsgBox "処理が完了しました！"
End Sub
```

**🚀 これで安心**:
- **リアルタイム進捗**：画面下部に「45%完了」と表示
- **キャンセル機能**：途中で「いいえ」を押せば中断
- **フリーズ防止**：「応答なし」にならないよう対策済み

---

## 🏢 業種別：実際に使える便利マクロ

### 📈 営業・管理職向け：レポート自動作成

#### 「毎月の売上レポート作りを自動化したい」

**プロンプト**:
```
売上データから月次レポートを自動生成するVBAマクロを作成してください。

【データ】
- Sheet1: 売上データ（日付、商品、金額）

【レポート内容】
1. 月別売上集計表
2. 商品別売上TOP5
3. 簡単なグラフ作成
4. 新しいシート「月次レポート」に出力
```

**AIが作ってくれるレポート自動作成マクロ（例）**:
```vb
Sub CreateMonthlyReport()
    ' 月次売上レポート自動作成
    
    ' 1. 「月次レポート」という新しいシートを作成
    ' 2. 今月の日付範囲で売上データを抽出
    ' 3. 以下の項目を自動計算：
    '    - 今月の売上合計
    '    - 商品別売上TOP5
    '    - 前月比較（増減）
    ' 4. 見やすい表形式で整理
    ' 5. 簡単なグラフも自動作成
    
    MsgBox "今月のレポートが完成しました！すぐに上司に提出できます。"
End Sub
```

**⏰ 時短効果**:
- **手作業だと**: データ抽出30分 + 表作成30分 + グラフ作成30分 = **計1.5時間**
- **マクロなら**: ボタン1つで **30秒完了**
- **品質向上**: 計算ミスゼロ、毎回同じ体裁で統一

### 💾 総務・事務向け：ファイル管理自動化

#### 「大事なファイルを自動でバックアップしたい」

**プロンプト**:
```
現在のワークブックを日付付きでバックアップするVBAマクロを作成してください。

【要件】
- ファイル名: 元のファイル名_YYYYMMDD_HHMMSS.xlsx
- 保存先: 元ファイルと同じフォルダ
- マクロは削除してから保存
- 成功/失敗をメッセージ表示
```

**AIが作ってくれるバックアップマクロ（例）**:
```vb
Sub CreateBackup()
    ' 自動バックアップ作成
    
    ' 1. 現在の日時を取得（例：20241215_143022）
    ' 2. 元ファイル名と日時を組み合わせて新しいファイル名作成
    '    例：「売上管理.xlsm」→「売上管理_20241215_143022.xlsx」
    ' 3. マクロコードを削除して通常のExcelファイルとして保存
    ' 4. 同じフォルダに保存完了
    
    On Error GoTo ErrorHandler
    
    ' （実際のバックアップ処理）
    
    MsgBox "バックアップが作成されました！安心して作業を続けてください。"
    Exit Sub
    
ErrorHandler:
    MsgBox "バックアップの作成に失敗しました。" & vbCrLf & "原因：" & Err.Description
End Sub
```

**🛡️ 安心の理由**:
- **自動ファイル名**：「売上管理_20241215_143022.xlsx」のように日時自動付与
- **マクロレス保存**：バックアップは普通のExcelファイルとして保存
- **エラー対応**：失敗しても原因を教えてくれる

---

## 🎓 練習問題（実際にやってみよう！）

### 🏆 練習1: 商品別売上集計マクロを作ってみよう

**チャレンジしてみてください！**

```
【データの状況】
A列: 日付（2024/12/1、2024/12/2...）
B列: 商品名（りんご、みかん、バナナ...）
C列: 販売数量（10、5、20...）
D列: 単価（100、80、150...）

【作りたいマクロ】
1. 商品ごとの合計数量を計算
2. 商品ごとの売上金額を計算（数量×単価）
3. 結果を「集計結果」という新しいシートに出力
4. 売上金額が多い順に並べ替え

【AIへのお願い方法】
上記の内容を参考に、あなた自身でAIにお願いしてみてください！
「完全初心者なので...」「コメント多めで...」を忘れずに。
```

### 🎨 練習2: 成績に応じた自動色分けマクロを作ってみよう

**さらにレベルアップ！**

```
【データの状況】
B列に売上金額が並んでいる（B2からB100まで）

【作りたいマクロ】
1. 売上上位20%の人→緑色（優秀！）
2. 売上下位20%の人→薄い赤色（要フォロー）
3. その他の人→色なし（普通）

【チャレンジ】
今回は自分でAIにお願いして、マクロを作ってもらってください。

【ヒント】
「上位20%、下位20%を自動で判定して色分けしたい」
「パーセンタイル関数を使って...」なんて難しいことは言わなくてOK。
普通の言葉で「上の方20%は緑、下の方20%は赤にしたい」でOKです！
```

---

## 🎉 おめでとうございます！VBA×AIマスターの仲間入り

### 今日できるようになったこと

1. **VBAって何？** → 身近な例で理解できた ✅
2. **AIへのお願い方法** → テンプレートを覚えた ✅  
3. **実用マクロ作成** → 3つのパターンを体験 ✅
4. **エラー対処** → 慌てず対応できるようになる ✅

### VBA×AIの成功のコツ（重要！）

#### ✅ AIに伝えるときのポイント
- **「完全初心者」**と最初に宣言
- **現在の手作業**を具体的に説明
- **「コメント多めで」**をお願い
- **心配事や希望**も素直に伝える

#### ✅ マクロを使うときのポイント
- **.xlsm形式**で保存（マクロが消えない）
- **小さなデータ**でまずテスト
- **エラーが出ても慌てない**（AIに聞けばOK）
- **バックアップ**を忘れずに

### 次のステップ

#### すぐにできること
1. **今日の内容を実際に試す**（手を動かすのが一番！）
2. **職場の繰り返し作業を1つ見つけてAIにマクロ作成をお願い**
3. **同僚に「マクロ作れるようになった」と自慢**

#### さらにスキルアップしたい方
- **[Excel分析AI](Excel分析AI.md)**: データ分析の自動化
- **[Excel数式AI](Excel数式AI.md)**: 複雑な数式もAIにお任せ
- **[データ分析](データ分析.md)**: 本格的なデータ活用

---

**🎊 あなたは今、「手作業中心」から「自動化活用」への第一歩を踏み出しました！** 

明日から職場で「その作業、マクロで自動化できますよ」と言えるあなたに変身です！