# 📊 CSV連携・活用 〜AI で楽々データ処理！〜


## 🎯 この講座のゴール

- 📁 CSVって何？を身近な例で理解する
- 🤖 AIにお願いしてCSVデータを分析してもらう
- 📈 実際の業務データで使える処理を3つマスターする
- 🚨 データが壊れても慌てず対処できるようになる

---

## 🤔 CSVって何？なぜAIと組み合わせると効果的なの？

### 身近な例で理解しよう

#### あなたの身の回りのCSVデータ
- **📱 スマホの家計簿アプリ**: 支出データをCSV出力 → 詳細分析
- **🛒 ECサイトの注文履歴**: 購入データをダウンロード → 年間支出チェック
- **💼 勤怠管理システム**: 出勤データをCSV出力 → 残業時間分析
- **📊 売上管理システム**: 日次売上データを出力 → 月次レポート作成

これら全て「**同じ形式でデータを受け渡し**」しているんです！

### CSV = データの「共通語」

#### 人間が見ると vs システムが見ると

**人間が見ると（Excel等で開いた時）**:
```
日付       | 商品名    | 売上金額
2024-01-01 | りんご    | 1,200
2024-01-02 | みかん    | 800
2024-01-03 | バナナ    | 600
```

**システムが見ると（CSVファイルの中身）**:
```
日付,商品名,売上金額
2024-01-01,りんご,1200
2024-01-02,みかん,800
2024-01-03,バナナ,600
```

### 簡単に言うと...
**CSV = どんなシステムでも読める「データの共通語」。AIがその言葉を理解して分析してくれる！**

---

## 📋 目次

1. [📁 CSVファイル読み込みの基本](#-csvファイル読み込みの基本)
2. [🤖 AIによるCSV分析自動化](#-aiによるcsv分析自動化)
3. [⚡ 大量データ処理テクニック](#-大量データ処理テクニック)
4. [🚨 エラーハンドリングと品質管理](#-エラーハンドリングと品質管理)
5. [💼 実践的な活用例](#-実践的な活用例)
6. [💡 演習問題](#-演習問題)

---

## 📁 CSVファイル読み込みの基本

### 🌟 初心者でもできる！CSVファイルの開き方

#### Step1: まずはExcel/Googleスプレッドシートで開いてみよう

**Excel の場合**:
1. 📂 CSVファイルを右クリック
2. 「プログラムから開く」→「Excel」を選択
3. ⚠️ 文字化けした場合: `データ`タブ → `テキストファイル` → `UTF-8`を選択

**Googleスプレッドシートの場合**:
1. 🌐 [sheets.google.com](https://sheets.google.com) を開く
2. 📁 ファイル → インポート → アップロード
3. CSVファイルをドラッグ&ドロップ
4. ✅ 「データを変換」で文字コードを自動判定

#### Step2: データの「健康診断」をしよう

**チェックポイント**:
- ✅ **文字化け**はないか？（日本語が「????」になってない？）
- ✅ **列の数**は想定通りか？（商品名が2つの列に分かれてない？）
- ✅ **データ型**は正しいか？（数字が文字として認識されてない？）
- ✅ **空白行・列**はないか？（途中に変な空行が入ってない？）

### 🤖 AIを使ったCSVデータ理解

#### 基本的なデータ理解プロンプト

```
「添付したCSVファイルを分析して、以下を教えてください：

【データの概要】
- 何のデータか（売上、顧客情報、アンケート結果など）
- データの期間・範囲
- 行数・列数

【データ品質チェック】
- 欠損値（空白）はあるか
- 異常値はないか
- データ型の問題はないか

【簡単な分析】
- 各列の基本統計（平均、最大、最小など）
- 特徴的な傾向・パターン
- 分析する際の注意点

初心者向けに、専門用語を使わず分かりやすく説明してください。」
```

#### 実践例: 売上データの分析

**元データ（sales.csv）**:
```csv
日付,店舗,商品カテゴリ,売上金額,客数
2024-01-01,新宿店,食品,45000,120
2024-01-01,渋谷店,衣料,32000,85
2024-01-02,新宿店,食品,52000,140
...
```

**AIからの回答例**:
```
📊 データの概要
- 小売店の日次売上データです
- 2024年1月の1ヶ月間、2店舗の実績
- 全620行、5列のデータ

🔍 データ品質チェック
✅ 欠損値: なし（完全なデータ）
⚠️ 異常値: 1月15日の渋谷店で売上0円の日あり（定休日？）
✅ データ型: 金額・客数は数値として正しく認識

📈 簡単な分析結果
- 平均日商: 38,500円
- 最高売上日: 1月28日（土曜）65,000円
- 店舗別: 新宿店が平均15%高い売上
- カテゴリ別: 食品70%、衣料30%の構成

💡 分析の注意点
- 土日の売上が平日の1.3倍高い傾向
- 月末にセールがあった可能性（売上急増）
```

---

## 🤖 AIによるCSV分析自動化

### 🎯 目的別分析プロンプト集

#### 📊 基本統計分析

```
「CSVデータの基本統計分析を行ってください：

【分析内容】
1. 数値列の基本統計（平均、中央値、標準偏差など）
2. カテゴリ列の度数分布
3. 時系列の傾向（日付列がある場合）
4. 相関関係の確認

【出力形式】
- 📈 グラフ作成用のデータ整理
- 📋 サマリーテーブルの作成
- 💡 ビジネス上の示唆・気づき

初心者が理解しやすいよう、数値の意味も併せて説明してください。」
```

#### 🔍 異常値・外れ値検出

```
「CSVデータの異常値を検出してください：

【検出したい異常】
- 📊 統計的外れ値（平均から大きく離れた値）
- 📅 時系列上の急激な変化
- 🔢 ビジネス上あり得ない値（負の売上など）
- 📝 入力ミスの可能性がある値

【対処方法も提案】
1. 削除すべき異常値
2. 修正すべき入力ミス
3. 重要な意味がある異常値

各異常値について「なぜ異常なのか」「どう対処するか」を説明してください。」
```

#### 📈 トレンド・季節性分析

```
「時系列CSVデータのトレンド分析を行ってください：

【分析観点】
1. 📈 長期トレンド（全体的な増減傾向）
2. 🔄 季節性パターン（月別、曜日別など）
3. 📊 周期性の検出（定期的な変動）
4. 🎯 特異点の特定（急激な変化点）

【ビジネス活用】
- 🔮 今後の予測値
- 📋 改善提案
- ⚠️ 注意すべき時期

グラフ化に適したデータ形式でも出力してください。」
```

### 🛠️ 実践的なデータ加工・整形

#### データクリーニングのプロンプト

```
「CSVデータのクリーニングを行ってください：

【クリーニング内容】
1. 🧹 重複データの除去
2. 📝 表記ゆれの統一（"株式会社"と"㈱"など）
3. 🔢 データ型の適切な変換
4. 📅 日付形式の統一
5. 💰 金額の桁区切り処理

【出力】
- クリーニング済みCSVデータ
- 変更内容のサマリー
- 今後のデータ入力時の注意点

どのような処理を行ったか、ステップごとに説明してください。」
```

#### データ結合・統合のプロンプト

```
「複数のCSVファイルを統合してください：

【統合条件】
- ファイル1: 顧客マスタ（ID、名前、属性）
- ファイル2: 購入履歴（顧客ID、商品、金額、日付）
- ファイル3: 商品マスタ（商品ID、カテゴリ、単価）

【結合方法】
1. 🔗 顧客IDで履歴と顧客情報を結合
2. 🔗 商品IDで商品情報を追加
3. 📊 分析用の項目計算（合計金額、購入回数など）

【注意点】
- マッチしないデータの処理方法
- 結合後のデータ品質チェック
- 重複の処理方法
```

---

## ⚡ 大量データ処理テクニック

### 📏 データサイズ別処理方法

#### 🟢 小規模データ（〜1万行）
**特徴**: Excel/Googleスプレッドシートで快適に処理可能

**おすすめ手法**:
- ✅ **直接開いて確認**: ファイルをダブルクリックで開く
- ✅ **基本的な関数使用**: SUM、AVERAGE、COUNTなど
- ✅ **フィルタ・並び替え**: 標準機能で十分

**AIプロンプト例**:
```
「1万行以下のCSVデータです。Excelの標準機能でできる分析方法を教えてください。
- ピボットテーブルの作成方法
- 基本的なグラフ作成
- 簡単な関数での集計
具体的な手順を初心者向けに説明してください。」
```

#### 🟡 中規模データ（1万〜10万行）
**特徴**: 処理に時間がかかる、メモリ使用量に注意

**おすすめ手法**:
- ⚡ **事前にデータ分割**: 期間別、店舗別に分けて処理
- 🎯 **必要な列だけ抽出**: 分析に不要な列は除外
- 💾 **適切な保存形式**: .xlsxよりも.csvの方が軽い

**AIプロンプト例**:
```
「5万行のCSVデータを効率的に処理したいです。

【処理内容】
- 月別の売上集計
- 商品カテゴリ別分析
- トップ10商品の抽出

【制約】
- PCのメモリは8GB
- Excel 2019使用

メモリ不足にならない処理手順を教えてください。」
```

#### 🔴 大規模データ（10万行以上）
**特徴**: Excel等では処理困難、専用ツールが必要

**おすすめ手法**:
- 🐍 **Python + pandas**: プログラミングでの処理
- 🗄️ **データベース**: SQLiteやMySQLでの管理
- ☁️ **クラウド処理**: Google Colab、AWS等

**AIプロンプト例**:
```
「50万行のCSVデータを分析したいのですが、Excelでは開けません。

【分析目標】
- 年間売上の推移
- 地域別業績比較
- 商品別収益性分析

【環境】
- プログラミング初心者
- Google Colab使用可能

ステップバイステップで処理方法を教えてください。」
```

### 🚀 処理速度向上のコツ

#### メモリ効率化テクニック

**1. 📊 データ型の最適化**
```
「CSVデータのメモリ使用量を削減してください：

【最適化ポイント】
- 数値データ: int64 → int32（必要に応じて）
- 日付データ: object → datetime
- カテゴリデータ: object → category
- 不要な列の削除

最適化前後のメモリ使用量も比較してください。」
```

**2. ⚡ チャンク処理**
```
「大量CSVデータをチャンク（分割）処理してください：

【処理方法】
1. ファイルを1万行ずつ読み込み
2. 各チャンクで集計処理
3. 結果をまとめて最終集計

【メリット】
- メモリ使用量の削減
- 処理の進捗が見える
- エラー時の影響範囲限定

Pythonのコード例も示してください。」
```

---

## 🚨 エラーハンドリングと品質管理

### 😱 よくあるCSVエラーと対処法

#### 🔤 文字化けエラー

**症状**: 日本語が「繧？繧？繧？」のような文字に変化

**原因と対処法**:
```
🔍 原因1: 文字コードの違い
💡 対処法: 
   - Excel: データ → テキストファイル → UTF-8選択
   - メモ帳: ファイル → 名前を付けて保存 → 文字コードUTF-8

🔍 原因2: 改行コードの違い（Windows vs Mac vs Linux）
💡 対処法:
   - テキストエディタで改行コードを統一
   - AIプロンプト: "改行コードを統一してください"
```

**AIプロンプト例**:
```
「文字化けしたCSVファイルを修復してください。

【症状】
- 日本語が「???」や変な記号になっている
- 一部の文字だけ化けている

【環境情報】
- 元システム: 会計ソフト
- 使用OS: Windows 10
- 開こうとしたソフト: Excel

修復方法と今後の予防策を教えてください。」
```

#### 📊 データ型エラー

**症状**: 数字が計算できない、日付が認識されない

**よくある例と対処法**:
```
❌ 数値に文字が混在: "1,200円" → "1200"
💡 対処法: CLEAN関数、VALUE関数で数値抽出

❌ 日付形式が不統一: "2024/1/1", "令和6年1月1日"
💡 対処法: DATEVALUE関数で統一形式に変換

❌ 空白セルの処理: 空白 vs 0 vs "N/A"
💡 対処法: IFERROR関数で適切な値に置換
```

**AIプロンプト例**:
```
「CSVデータの型変換を行ってください：

【問題のあるデータ】
- 金額列: "¥1,200", "2,500円", "無料" が混在
- 日付列: "2024-01-01", "2024/1/1", "1月1日" が混在
- 数量列: 空白、"不明"、"0" が混在

【希望する形式】
- 金額: 数値のみ（円マーク除去）
- 日付: YYYY-MM-DD形式で統一
- 数量: 数値（不明は0に変換）

変換用の数式やコードを教えてください。」
```

#### 🔢 データ整合性エラー

**症状**: 関連するデータ間で矛盾がある

**チェックポイントと対処法**:
```
✅ 合計値チェック: 明細の合計 = ヘッダーの合計額
✅ 日付整合性: 開始日 ≤ 終了日
✅ 範囲チェック: 年齢は0-120歳、割引率は0-100%
✅ 必須項目チェック: 顧客ID、商品コードは必須
✅ 重複チェック: 同一取引の重複登録なし
```

**AIプロンプト例**:
```
「CSVデータの整合性をチェックしてください：

【チェック項目】
1. 売上明細の金額合計 = 請求書の合計金額
2. 商品コードがマスタに存在するか
3. 販売数量 × 単価 = 売上金額
4. 割引率が0-100%の範囲内か
5. 同一注文番号の重複なし

【エラー発見時の対応】
- エラーの種類と件数
- 修正提案
- 今後の入力ルール
```

### 🛡️ データ品質管理のベストプラクティス

#### 事前チェックリスト

**📋 受け取り時のチェック**:
```
□ ファイルサイズは適切か（異常に大きい/小さくないか）
□ 拡張子は正しいか（.csv, .txt）
□ 文字化けはないか
□ 列数は想定通りか
□ ヘッダー行は正しいか
```

**📊 内容チェック**:
```
□ データ件数は想定範囲内か
□ 必須項目に空白はないか
□ 数値項目に文字は含まれていないか
□ 日付形式は統一されているか
□ 異常値はないか（負の売上、未来日付など）
```

**AIプロンプト例**:
```
「CSVデータの品質チェックレポートを作成してください：

【チェック内容】
1. 📊 基本情報（行数、列数、ファイルサイズ）
2. 🔍 欠損値の確認（列ごとの欠損率）
3. 📈 数値項目の統計情報（最大・最小・平均）
4. 📅 日付項目の範囲確認
5. 🏷️ カテゴリ項目の種類確認
6. ⚠️ 異常値・外れ値の検出

【レポート形式】
- 🟢 問題なし
- 🟡 注意が必要
- 🔴 修正が必要

で色分けして、優先度付きで報告してください。」
```

---

## 💼 実践的な活用例

### 🏢 ビジネスシーン別活用法

#### 📊 売上分析（小売業）

**シナリオ**: 複数店舗の日次売上データを分析

**データ例**:
```csv
日付,店舗コード,商品カテゴリ,売上金額,客数,天気
2024-01-01,001,食品,45000,120,晴れ
2024-01-01,002,衣料,32000,85,晴れ
2024-01-02,001,食品,38000,95,雨
...
```

**AIプロンプト**:
```
「小売店の売上データを分析してください：

【分析目標】
1. 📈 店舗別業績比較
2. 🌦️ 天気と売上の関係
3. 📅 曜日別売上パターン
4. 🛍️ 商品カテゴリ別トレンド
5. 🎯 売上向上の改善提案

【出力希望】
- 📊 グラフ用データ
- 📋 サマリーレポート
- 💡 アクションプラン

マネージャーが理解しやすい形でお願いします。」
```

#### 👥 顧客分析（サービス業）

**シナリオ**: 会員の利用履歴から顧客セグメンテーション

**データ例**:
```csv
顧客ID,年齢,性別,利用回数,総利用金額,最終利用日,登録日
C001,28,女性,15,45000,2024-01-15,2023-06-01
C002,45,男性,3,8500,2023-12-20,2023-11-15
...
```

**AIプロンプト**:
```
「顧客データからセグメンテーション分析をしてください：

【分析観点】
1. 👑 優良顧客（高頻度・高単価）の特徴
2. 😴 休眠顧客（長期未利用）の把握
3. 🆕 新規顧客の定着率
4. 📊 年代・性別別の利用パターン
5. 💰 顧客生涯価値（LTV）の計算

【マーケティング活用】
- ターゲット別キャンペーン提案
- 離脱防止策
- 新規獲得戦略

実行しやすい施策も含めて提案してください。」
```

#### 📋 在庫管理（製造業）

**シナリオ**: 部品の入出庫データから適正在庫を算出

**データ例**:
```csv
部品コード,入庫数,出庫数,在庫数,単価,仕入先,日付
P001,100,80,120,250,A社,2024-01-01
P002,50,45,85,450,B社,2024-01-01
...
```

**AIプロンプト**:
```
「在庫データから最適化提案をしてください：

【分析内容】
1. 📦 回転率の高い部品・低い部品
2. 🔄 発注サイクルの最適化
3. 💰 在庫コストの削減提案
4. ⚠️ 欠品リスクの高い部品
5. 📈 需要予測（向こう3ヶ月）

【改善提案】
- 適正在庫数の算出
- 発注タイミングの自動化
- 不動在庫の処分提案

コスト削減効果も数値で示してください。」
```

### 🎯 業務自動化の実装

#### 📊 レポート自動生成

**Googleスプレッドシート + GAS での実装例**:

**AIプロンプト**:
```
「CSVデータから月次レポートを自動生成するGASを作成してください：

【機能要件】
1. 📁 Google DriveのCSVファイルを自動読み込み
2. 📊 基本統計の計算（合計、平均、前月比）
3. 📈 グラフの自動作成（棒グラフ、折れ線グラフ）
4. 📧 完成したレポートをメール配信
5. 📅 毎月1日の朝9時に自動実行

【レポート内容】
- サマリー数値
- 前月との比較
- トップ10ランキング
- 注意が必要な項目

コメント付きのコードでお願いします。」
```

#### 🚨 異常値検知アラート

**AIプロンプト**:
```
「CSVデータの異常値を監視するシステムを作成してください：

【監視項目】
1. 📊 売上が前日比50%以上変動
2. 🔢 在庫数がマイナスになった
3. 💰 単価が通常の2倍以上
4. 📅 未来日付のデータ
5. 🆔 存在しない商品コード

【アラート機能】
- 📧 メール通知（緊急度別）
- 📱 Slack通知
- 📋 異常値レポート作成

【自動対応】
- 軽微な異常: 修正提案
- 重大な異常: 処理停止
```

---

## 💡 演習問題

### 🏃 初級演習: 基本的なデータ分析

**📊 問題1: 売上データの基本分析**

以下のCSVデータを分析してください：

```csv
日付,商品名,カテゴリ,売上金額,販売数
2024-01-01,りんご,果物,1200,4
2024-01-01,バナナ,果物,800,8
2024-01-02,パン,パン類,600,2
2024-01-02,牛乳,乳製品,300,2
2024-01-03,りんご,果物,900,3
```

**分析課題**:
1. 📈 日別売上合計
2. 🍎 商品別売上ランキング
3. 🏷️ カテゴリ別売上構成比
4. 💰 平均単価の計算

**AIプロンプトを作成**:
```
「上記のCSVデータを分析して、以下を算出してください：
[あなたがプロンプトを完成させてください]
```

### 🚀 中級演習: データクリーニング

**🧹 問題2: 汚れたデータの修復**

以下の問題があるCSVデータを修正してください：

```csv
顧客名,年齢,売上金額,登録日
田中太郎,28,"¥12,000",2024-01-01
"佐藤,花子",不明,15000円,2024/1/2
山田次郎,,"¥8,500",令和6年1月3日
田中太郎,28,12000,2024-01-01
```

**修正課題**:
1. 🔄 重複データの除去
2. 💰 金額の表記統一
3. 📅 日付形式の統一
4. 📝 欠損値の処理

### 🏆 上級演習: 業務システム構築

**⚙️ 問題3: 自動監視システム**

月次売上CSVファイルを監視し、以下の条件で自動アラートを送信するシステムを設計してください：

**監視条件**:
- 📊 前月比20%以上の変動
- 🚨 売上0円の日が3日連続
- 💰 平均単価が50%以上変動
- 📈 新商品の売上が予想を下回る

**システム要件**:
1. 🤖 Google Apps Scriptで実装
2. 📧 Gmail + Slack通知
3. 📊 ダッシュボード表示
4. 📋 週次サマリーレポート

**設計課題**:
```
1. システム構成図の作成
2. 必要なGAS関数の一覧
3. 監視ロジックの詳細設計
4. テストケースの作成
```

---

## 📚 参考資料・ツール

### 🛠️ 推奨ツール

#### 📊 初心者向け
- **Microsoft Excel**: 基本的なCSV処理
- **Google スプレッドシート**: クラウドでの共同作業
- **LibreOffice Calc**: 無料のオフィススイート

#### ⚡ 中級者向け
- **Google Colab**: ブラウザでPythonプログラミング
- **Jupyter Notebook**: データ分析の定番
- **Tableau Public**: 無料のBIツール

#### 🚀 上級者向け
- **Python + pandas**: 最強のデータ処理
- **R + dplyr**: 統計分析特化
- **Power BI**: マイクロソフトのBI ツール

### 📖 学習リソース

#### 🎓 基礎知識
- 📚 「Excel関数辞典」（基本関数の理解）
- 🎬 YouTube「ExcelのCSV処理入門」
- 📱 アプリ「関数電卓」（計算の確認用）

#### 🤖 AI活用
- 💡 ChatGPT/Claude: データ分析プロンプト集
- 🔧 Google Bard: スプレッドシート連携
- 📊 Microsoft Copilot: Excel統合

---

## ✅ 理解度確認チェック

### 📋 基本知識チェック

以下の質問に答えられるか確認してください：

**🤔 基本概念**:
1. CSVとExcelファイルの違いを説明できますか？
2. 文字コードが原因の文字化けを修正できますか？
3. データ型（数値、文字、日付）の違いを理解していますか？

**🛠️ 実務スキル**:
4. 1万行のCSVファイルを効率的に開けますか？
5. AIプロンプトで適切な分析を依頼できますか？
6. 異常値を発見して適切に対処できますか？

**📊 分析能力**:
7. 基本統計（平均、合計、最大値など）を計算できますか？
8. データの傾向やパターンを読み取れますか？
9. ビジネス上の改善提案を作成できますか？

### 🎯 実践課題

**最終確認**: 実際のCSVファイルで以下を実行してください

1. **📁 データ準備**
   - 自分の業務に関連するCSVデータを用意
   - データの概要をAIに分析してもらう

2. **🔍 品質チェック**
   - 異常値・欠損値をチェック
   - 必要な修正を実施

3. **📊 基本分析**
   - 合計、平均などの基本統計を計算
   - 簡単なグラフを作成

4. **💡 改善提案**
   - 分析結果から業務改善案を3つ考案
   - 実行可能性と効果を評価

**🎉 全て完了できれば次の講座に進めます！**

---

**次の講座**: [📊 データ分析・可視化](../データ分析/データ分析・可視化.md)

<!-- 動画埋め込み用プレースホルダー -->
<!-- VIDEO: csv-basics.mp4 -->
<!-- VIDEO: csv-ai-analysis.mp4 -->
<!-- VIDEO: csv-error-handling.mp4 -->
<!-- VIDEO: csv-business-cases.mp4 -->