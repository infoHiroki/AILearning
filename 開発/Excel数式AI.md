# Excel関数 + AI活用

**所要時間**: 30分  
**レベル**: 中級  
**前提知識**: [基礎講座群](../basic/)完了

## 学習目標

この講座を修了すると、以下ができるようになります：
- AIを使ってExcel関数を効率的に作成できる
- 複雑な条件分岐や計算式を自動生成できる
- 関数のエラーを診断・修正できる
- 実務で使える関数を素早く構築できる

---

## Excel関数の基礎

### Excel関数とは

**関数**は、特定の計算や処理を自動で実行する命令のことです。Excelには数百種類の関数が用意されており、手作業では困難な複雑な計算も簡単に実行できます。

### 関数の基本構造

```excel
=関数名(引数1, 引数2, ...)
```

**例**:
```excel
=SUM(A1:A10)  ' A1からA10までの合計
=IF(B2>100, "合格", "不合格")  ' 条件によって結果を変える
```

### 基本的な関数

#### 計算系関数
```excel
=SUM(A1:A10)      ' 合計を計算
=AVERAGE(A1:A10)  ' 平均を計算
=COUNT(A1:A10)    ' 数値の個数を数える
=MAX(A1:A10)      ' 最大値を取得
=MIN(A1:A10)      ' 最小値を取得
```

#### 論理系関数
```excel
=IF(条件, 真の場合, 偽の場合)
=AND(条件1, 条件2)  ' すべての条件が真の場合にTRUE
=OR(条件1, 条件2)   ' いずれかの条件が真の場合にTRUE
```

#### 文字列系関数
```excel
=LEN(A1)          ' 文字数を数える
=LEFT(A1, 3)      ' 左から3文字を取得
=RIGHT(A1, 3)     ' 右から3文字を取得
=MID(A1, 2, 3)    ' 2文字目から3文字を取得
```

#### 検索系関数
```excel
=VLOOKUP(検索値, 表範囲, 列番号, FALSE)
=INDEX(範囲, 行番号, 列番号)
=MATCH(検索値, 検索範囲, 0)
```

### セル参照の種類

#### 相対参照
```excel
=A1+B1
```
コピー時に参照するセルが自動的に移動

#### 絶対参照
```excel
=$A$1+$B$1
```
コピー時でも参照するセルが固定

#### 混合参照
```excel
=$A1+B$1
```
行または列のどちらかを固定

### 関数の入力方法

#### 1. 直接入力
1. セルをクリック
2. `=`を入力
3. 関数名と引数を入力
4. `Enter`キーで確定

#### 2. 関数ウィザードを使用
1. セルを選択
2. `数式`タブ → `関数の挿入`
3. 関数を選択して設定
4. `OK`で確定

#### 3. オートコンプリート機能
- `=SU`と入力すると候補が表示される
- `Tab`キーで選択、`Enter`で確定

### エラーの種類と対処

```excel
#VALUE!  ' 引数の型が間違っている
#DIV/0!  ' 0で割り算している
#N/A     ' 検索値が見つからない
#REF!    ' 参照先のセルが削除されている
#NAME?   ' 関数名が間違っている
```

---

## AIでExcel関数を作る基本

### 基本的な関数生成プロンプト

```
以下の条件でExcel関数を作成してください。

【やりたいこと】
[具体的な計算や判定内容]

【データ構造】
- A列: [内容]
- B列: [内容]
- C列: [内容]

【条件】
[具体的な条件や制約]

【出力】
関数式と簡単な説明をお願いします。
```

### シンプルな例から始める

#### 例1: 基本的な条件判定

**やりたいこと**: 売上金額に応じてランク付け

**プロンプト**:
```
売上金額（B列）に応じてランクを判定するExcel関数を作成してください。

【条件】
- 100万円以上: A
- 50万円以上: B  
- 30万円以上: C
- それ未満: D

結果をC列に表示したいです。
```

**AI生成例**:
```excel
=IF(B2>=1000000,"A",IF(B2>=500000,"B",IF(B2>=300000,"C","D")))
```

#### 例2: 複数条件の組み合わせ

**プロンプト**:
```
営業成績評価を自動化したいです。

【データ】
- B列: 売上金額
- C列: 新規顧客数
- D列: 顧客満足度（1-5）

【評価基準】
- 優秀: 売上500万円以上 かつ 新規顧客10件以上 かつ 満足度4以上
- 良好: 売上300万円以上 かつ 新規顧客5件以上 かつ 満足度3以上
- 標準: それ以外

E列に結果を表示してください。
```

**AI生成例**:
```excel
=IF(AND(B2>=5000000,C2>=10,D2>=4),"優秀",
 IF(AND(B2>=3000000,C2>=5,D2>=3),"良好","標準"))
```

---

## 実用的な関数パターン

### 集計・分析系の関数

#### 条件付き集計

**プロンプト**:
```
商品別・地域別の売上集計を行いたいです。

【データ】
- A列: 商品名
- B列: 地域  
- C列: 売上金額

【条件】
特定の商品（F1セル）と特定の地域（G1セル）の売上合計を求めたいです。
```

**AI生成例**:
```excel
=SUMIFS(C:C,A:A,F1,B:B,G1)
```

#### 動的な順位付け

**プロンプト**:
```
売上ランキングを自動化したいです。

【要件】
- B列の売上金額を降順でランク付け
- 同順位がある場合は同じ順位
- 空白セルは除外

C列にランクを表示してください。
```

**AI生成例**:
```excel
=IF(B2="","",RANK(B2,B:B,0))
```

### 日付・時間の計算

#### 営業日計算

**プロンプト**:
```
納期管理に使える関数を作成してください。

【要件】
- A列: 受注日
- B列: 製造日数（営業日ベース）
- C列: 納期（営業日で計算、土日祝除く）

日本の祝日は考慮せず、土日のみ除外してください。
```

**AI生成例**:
```excel
=WORKDAY(A2,B2)
```

#### 期間分析

**プロンプト**:
```
プロジェクトの進捗管理用の関数を作成してください。

【データ】
- A列: 開始日
- B列: 終了予定日
- C列: 現在の進捗率（%）

【計算したいもの】
D列: 予定通り進んでいるかの判定（「順調」「遅れ」「完了」）
```

**AI生成例**:
```excel
=IF(C2>=100,"完了",
 IF(C2>=(TODAY()-A2)/(B2-A2)*100,"順調","遅れ"))
```

---

## エラー対処とデバッグ

### よくあるエラーの修正

#### #VALUE! エラーの対処

**プロンプト**:
```
以下の関数で#VALUE!エラーが出ます。修正してください。

【エラー関数】
=IF(A2>100000,"高","低")

【状況】
A列には数値が入っているはずですが、一部のセルで文字列になっているかもしれません。
エラーが出ても動作する関数にしてください。
```

**AI修正例**:
```excel
=IF(ISNUMBER(A2),IF(A2>100000,"高","低"),"データエラー")
```

#### #N/A エラーの対処

**プロンプト**:
```
VLOOKUP関数でエラーが出ます。

【現在の関数】
=VLOOKUP(A2,Sheet2!A:B,2,FALSE)

【問題】
検索値が見つからない場合に#N/Aエラーになります。
見つからない場合は「該当なし」と表示したいです。
```

**AI修正例**:
```excel
=IFERROR(VLOOKUP(A2,Sheet2!A:B,2,FALSE),"該当なし")
```

### 関数の最適化

#### 処理速度の改善

**プロンプト**:
```
以下の関数の処理が重いです。最適化してください。

【現在の関数】
=SUMPRODUCT((Sheet1!A:A=A2)*(Sheet1!B:B=B2)*Sheet1!C:C)

【データ規模】
約5000行のデータで、この関数を500行分使用しています。
```

**AI最適化例**:
```excel
=SUMIFS(Sheet1!C:C,Sheet1!A:A,A2,Sheet1!B:B,B2)
```

---

## 業務別活用例

### 売上管理

#### 目標達成率の可視化

**プロンプト**:
```
売上目標の達成状況を表示する関数を作成してください。

【データ】
- B列: 月間売上実績
- C列: 月間売上目標

【表示したいもの】
- D列: 達成率（%表示）
- E列: 達成状況（「達成」「未達成」「大幅未達成（80%未満）」）
```

**AI生成例**:
```excel
D列: =IF(C2=0,"",B2/C2)
E列: =IF(D2="","",IF(D2>=1,"達成",IF(D2>=0.8,"未達成","大幅未達成")))
```

### 在庫管理

#### 発注判定

**プロンプト**:
```
在庫管理の発注判定を自動化したいです。

【データ】
- A列: 商品名
- B列: 現在庫数
- C列: 安全在庫数
- D列: 発注ロット

【判定ルール】
現在庫が安全在庫を下回ったら「発注必要」
発注数量は発注ロットの倍数で、安全在庫の2倍になるように計算
```

**AI生成例**:
```excel
E列（発注判定）: =IF(B2<=C2,"発注必要","在庫十分")
F列（発注数量）: =IF(E2="発注必要",CEILING((C2*2-B2),D2),"")
```

---

## 実践演習

### 演習1: 給与計算システム

以下の条件で給与計算関数を作成してください：

```
【データ】
- A列: 従業員名
- B列: 基本給
- C列: 残業時間
- D列: 営業成績（売上金額）

【計算ルール】
- 残業代: 基本給÷160時間×1.25×残業時間
- 営業手当: 売上500万円以上で基本給の10%、300万円以上で5%
- 総支給額 = 基本給 + 残業代 + 営業手当

【作成する関数】:
E列（残業代）: 
F列（営業手当）: 
G列（総支給額）: 
```

### 演習2: 顧客分析

顧客の購買パターンを分析する関数を作成してください：

```
【データ】
- A列: 顧客ID
- B列: 最終購入日
- C列: 購入回数
- D列: 累計購入金額

【分析項目】
- E列: 最終購入からの経過日数
- F列: 顧客ランク（VIP: 100万円以上、優良: 50万円以上、一般: それ以外）
- G列: アクション判定（90日以上購入なしで「要フォロー」）

【作成する関数】:
E列: 
F列: 
G列: 
```

---

## まとめ

AIを活用したExcel関数作成は、以下のポイントを押さえることで効率的に行えます：

- **具体的な条件を明確に伝える**
- **データ構造を正確に説明する**
- **エラー処理も考慮した関数を作る**
- **実際の業務で使いやすい形にする**

次は [Excel VBA + AI](excel-vba-ai.md) で、より高度な自動化を学びましょう！